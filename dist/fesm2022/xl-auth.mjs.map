{"version":3,"file":"xl-auth.mjs","sources":["../../src/lib/xl-auth.config.ts","../../src/lib/auth.service.ts","../../src/lib/auth.guard.ts","../../src/lib/auth.interceptor.ts","../../src/lib/provideAuth.ts","../../src/public-api.ts","../../src/xl-auth.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\nexport interface XlAuthConfig {\n    apiUrl: string;\n}\nexport const XL_AUTH_CONFIG = new InjectionToken<XlAuthConfig>('XL_AUTH_CONFIG');\n","import { Inject, inject, Injectable } from '@angular/core';\nimport { XL_AUTH_CONFIG, XlAuthConfig } from './xl-auth.config';\nimport { HttpClient } from '@angular/common/http';\nimport { AuthRequest, AuthResponse, UserInfo } from './models';\nimport { BehaviorSubject, tap } from 'rxjs';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n\n    constructor(\n        private http: HttpClient,\n        @Inject(XL_AUTH_CONFIG) private api: XlAuthConfig\n    ) {}\n\n\n    private sub_api = '/erp/auth';\n    private userSubject = new BehaviorSubject<UserInfo | null>(null);\n    user$ = this.userSubject.asObservable();\n\n    login(data: AuthRequest) {\n        return this.http\n            .post<AuthResponse>(`${this.api.apiUrl}${this.sub_api}/login`, data)\n            .pipe(tap(res => localStorage.setItem('token', res.token)));\n    }\n\n    loadUser() {\n        return this.http\n            .post<UserInfo>(`${this.api.apiUrl}${this.sub_api}/me`, {})\n            .pipe(tap(user => this.userSubject.next(user)));\n    }\n\n    logout() {\n        localStorage.removeItem('token');\n        this.userSubject.next(null);\n    }\n\n    isLoggedIn(): boolean {\n        return !!localStorage.getItem('token');\n    }\n\n    get token() {\n        return localStorage.getItem('token');\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot, CanActivate, GuardResult, MaybeAsync, Router, RouterStateSnapshot } from '@angular/router';\nimport { AuthService } from './auth.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthGuard implements CanActivate {\n    constructor(\n        private authService: AuthService,\n        private router: Router\n    ) {}\n\n\n    canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): MaybeAsync<GuardResult> {\n       if(this.authService.isLoggedIn()) {\n           return true;\n       }\n\n       this.router.navigate(['/login']);\n       return false;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\nimport { AuthService } from './auth.service';\n\n\n@Injectable()\nexport class AuthInterceptor implements HttpInterceptor {\n    constructor(private authService: AuthService) {}\n\n    intercept(req: HttpRequest<any>, next: HttpHandler) {\n        const token = this.authService.token;\n\n        if (token) {\n            req = req.clone({\n                setHeaders: {\n                    Authorization: `Bearer ${token}`\n                }\n            });\n        }\n        return next.handle(req);\n    }\n}\n","import { Provider } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { AuthInterceptor } from './auth.interceptor';\nimport { XL_AUTH_CONFIG, XlAuthConfig } from './xl-auth.config';\nimport { config } from 'rxjs';\n\nexport function provideAuth(config: XlAuthConfig): Provider[] {\n    return [\n        { provide: XL_AUTH_CONFIG, useValue: config},\n        {provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true},\n    ];\n}\n","/*\n * Public API Surface of xl-auth\n */\n\n// export * from './lib/xl-auth';\n\nexport * from './lib/auth.service';\nexport * from './lib/models';\nexport * from './lib/auth.guard';\nexport * from './lib/auth.interceptor';\nexport * from './lib/xl-auth.config';\n// export * from './lib/'; // ако имаш модул\nexport * from './lib/provideAuth';     // ако имаш provideAuth()\n\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1.AuthService"],"mappings":"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"}